<link rel="import" href="login-dialog.html">

<script>
  if (!window.WebvisualLoginDialog) {
    window.WebvisualLoginDialog = document.createElement('login-dialog');
    document.body.appendChild(window.WebvisualLoginDialog);
  }

  window.WebvisualMixins = window.WebvisualMixins || {};
  /**
   * Mixin adds retry strategies for offline and login changes for reloading data
   *
   * @mixinFunction
   * @polymer
   */
  WebvisualMixins.AccessibilityMixin = function(superClass) {

    return class extends superClass {

      static get properties() {
        return {
          loggedIn: {
            type: Boolean,
            notify: true
          },

          offline: {
            type: Boolean,
            notify: true
          },

          signInUrl: {
            type: String,
            value: '/login'
          },

          signOutUrl: {
            type: String,
            value: '/logout'
          },

          signOutUrl: {
            type: String,
            value: '/auth'
          }
        }
      }

      static get observers() {
        '_signInOutUrlsChanged(signInUrl, signOutUrl, authUrl)'
      }

      connectedCallback() {
        super.connectedCallback();
        this._load = this._load.bind(this);
        window.addEventListener('online', this._load);
        window.addEventListener('offline', this._load);
        window.addEventListener('logged-in', this._load);
      }

      disconnectedCallback() {
        super.connectedCallback();
        window.removeEventListener('online', this._load);
        window.removeEventListener('offline', this._load);
        window.removeEventListener('logged-in', this._load);
      }

      _signInOutUrlsChanged(signInUrl, signOutUrl, authUrl) {
        window.WebvisualLoginDialog.signInUrl = signInUrl || '/login';
        window.WebvisualLoginDialog.signOutUrl = signOutUrl || '/logout';
        window.WebvisualLoginDialog.authUrl = authUrl || '/auth';
      }

      /**
       * @overwrite
       */
      _load() {
        this.offline = !Boolean(window.navigator.onLine);
        this.loggedIn = Boolean(window._loggedIn);
      }

      openLoginDialog() {
        window.WebvisualLoginDialog.open();
      }

      signOut() {
        window.WebvisualLoginDialog.signOut();
      }
    }
  }
</script>
